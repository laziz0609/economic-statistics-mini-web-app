<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valyuta Kursi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 24px;
            text-align: center;
            color: var(--tg-theme-text-color, #000000);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000000);
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        .currency-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .currency-row select {
            flex: 1;
        }

        .swap-btn {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 28px;
        }

        .swap-btn:active {
            opacity: 0.7;
        }

        .result-container {
            margin-top: 24px;
            padding: 20px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-title {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 12px;
        }

        .result-info {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
        }

        .amount-input-group {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--tg-theme-hint-color, #999);
            font-size: 16px;
            pointer-events: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--tg-theme-hint-color, #999);
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            display: none;
        }

        .error.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ’± Valyuta Kursi</h1>
        
        <div class="form-group">
            <label for="date">Sana</label>
            <input type="date" id="date">
        </div>

        <div class="form-group">
            <label for="amount">Miqdor</label>
            <div class="amount-input-group">
                <input type="number" id="amount" value="1" min="0" step="0.01">
            </div>
        </div>

        <div class="form-group">
            <label>Valyuta konvertatsiyasi</label>
            <div class="currency-row">
                <select id="fromCurrency">
                    <option value="USD">USD - AQSH Dollari</option>
                    <option value="EUR">EUR - Yevro</option>
                    <option value="RUB">RUB - Rossiya Rubli</option>
                    <option value="GBP">GBP - Funt Sterling</option>
                    <option value="JPY">JPY - Yapon Yenasi</option>
                    <option value="CNY">CNY - Xitoy Yuani</option>
                    <option value="KRW">KRW - Koreya Voni</option>
                    <option value="TRY">TRY - Turk Lirasi</option>
                    <option value="UZS">UZS - O'zbek So'mi</option>
                </select>
                
                <button class="swap-btn" id="swapBtn">â‡„</button>
                
                <select id="toCurrency">
                    <option value="UZS">UZS - O'zbek So'mi</option>
                    <option value="USD">USD - AQSH Dollari</option>
                    <option value="EUR">EUR - Yevro</option>
                    <option value="RUB">RUB - Rossiya Rubli</option>
                    <option value="GBP">GBP - Funt Sterling</option>
                    <option value="JPY">JPY - Yapon Yenasi</option>
                    <option value="CNY">CNY - Xitoy Yuani</option>
                    <option value="KRW">KRW - Koreya Voni</option>
                    <option value="TRY">TRY - Turk Lirasi</option>
                </select>
            </div>
        </div>

        <div class="result-container" id="resultContainer">
            <div class="result-title">Natija</div>
            <div class="result-value" id="resultValue">-</div>
            <div class="result-info" id="resultInfo">-</div>
        </div>

        <div class="error" id="errorMessage"></div>
    </div>

    <script>
        // Telegram Web App ni ishga tushirish
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText('Kursni Ko\'rish');
        tg.MainButton.show();

        // Bugungi sanani Toshkent vaqti bilan o'rnatish
        function getTashkentDate() {
            const now = new Date();
            const tashkentTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Tashkent' }));
            const year = tashkentTime.getFullYear();
            const month = String(tashkentTime.getMonth() + 1).padStart(2, '0');
            const day = String(tashkentTime.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        document.getElementById('date').value = getTashkentDate();
        document.getElementById('date').max = getTashkentDate();

        // Valyutalarni almashtirish
        document.getElementById('swapBtn').addEventListener('click', () => {
            const fromCurrency = document.getElementById('fromCurrency');
            const toCurrency = document.getElementById('toCurrency');
            const temp = fromCurrency.value;
            fromCurrency.value = toCurrency.value;
            toCurrency.value = temp;
        });

        // Ma'lumotlarni tayyorlash va botga yuborish
        tg.MainButton.onClick(() => {
            const date = document.getElementById('date').value;
            const amount = parseFloat(document.getElementById('amount').value) || 1;
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;

            if (!date) {
                showError('Iltimos, sanani tanlang');
                return;
            }

            if (amount <= 0) {
                showError('Miqdor 0 dan katta bo\'lishi kerak');
                return;
            }

            if (fromCurrency === toCurrency) {
                showError('Bir xil valyutani tanlash mumkin emas');
                return;
            }

            // Ma'lumotlarni botga yuborish
            const data = {
                date: date,
                amount: amount,
                from: fromCurrency,
                to: toCurrency
            };

            tg.sendData(JSON.stringify(data));
        });

        // Botdan kelgan ma'lumotlarni qabul qilish va ko'rsatish
        // Bu funksiya bot tomonidan web_app_data event orqali ma'lumot kelganda ishga tushadi
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'currency_result') {
                displayResult(event.data);
            }
        });

        // Natijani ko'rsatish funksiyasi
        function displayResult(data) {
            const resultContainer = document.getElementById('resultContainer');
            const resultValue = document.getElementById('resultValue');
            const resultInfo = document.getElementById('resultInfo');

            if (data.error) {
                showError(data.error);
                return;
            }

            const amount = data.amount || 1;
            const fromCurrency = data.from || 'USD';
            const toCurrency = data.to || 'UZS';
            const rate = data.rate || 0;
            const result = amount * rate;

            resultValue.textContent = `${result.toLocaleString('uz-UZ', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            })} ${toCurrency}`;
            
            resultInfo.textContent = `${amount} ${fromCurrency} = ${result.toLocaleString('uz-UZ', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            })} ${toCurrency}\nKurs: 1 ${fromCurrency} = ${rate.toLocaleString('uz-UZ', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            })} ${toCurrency}\nSana: ${data.date || ''}`;

            resultContainer.classList.add('show');
            hideError();
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.classList.add('show');
            
            setTimeout(() => {
                hideError();
            }, 5000);
        }

        function hideError() {
            document.getElementById('errorMessage').classList.remove('show');
        }

        // Telegram tema ranglarini qo'llash
        if (tg.colorScheme === 'dark') {
            document.body.style.background = '#18222d';
        }

        // Telegram Web App tayyor ekanligini bildirish
        tg.ready();
    </script>
</body>
</html>
